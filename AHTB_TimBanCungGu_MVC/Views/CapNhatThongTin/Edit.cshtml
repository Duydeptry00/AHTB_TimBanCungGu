@model AHTB_TimBanCungGu_API.Models.ThongTinCaNhan

@{
    ViewData["Title"] = "Chỉnh sửa Thông tin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<link rel="stylesheet" href="~/css/capnhatthongtin.css">
<div class="container mt-5">
    <!-- Phần tiêu đề -->
    <div class="text-center mb-4">
        <h1>Chỉnh sửa Thông tin Cá nhân</h1>
    </div>
    <style>


        .custom-swal-popup {
            margin-top: 70px !important; /* Đảm bảo margin-top cho popup */
        }
    </style>

    <!-- Bố cục chính -->
    <div class="card shadow-lg custom-card">
        <div class="card-body">
            <form asp-action="Edit" method="post" enctype="multipart/form-data">
                <!-- Hidden field cho ID Profile -->
                <input type="hidden" asp-for="IDProfile" />

                <!-- Phần cập nhật thông tin cá nhân -->
                <div class="row mb-4">
                    <!-- Hàng 1: Thông tin cá nhân -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Họ tên:</label>
                            <input asp-for="HoTen" title="Nhập họ tên" class="form-control" required />
                            <span asp-validation-for="HoTen" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Giới tính:</label>
                            <div class="form-check d-inline-block mr-2">
                                <input asp-for="GioiTinh" class="form-check-input" type="radio" value="Nam" id="Nam" />
                                <label class="form-check-label" for="Nam">Nam</label>
                            </div>
                            <div class="form-check d-inline-block">
                                <input asp-for="GioiTinh" class="form-check-input" type="radio" value="Nữ" id="Nu" />
                                <label class="form-check-label" for="Nu">Nữ</label>
                            </div>
                            <span asp-validation-for="GioiTinh" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Ngày sinh:</label>
                            <input asp-for="NgaySinh" type="date" class="form-control" id="ngaySinh" />
                            <span asp-validation-for="NgaySinh" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Số điện thoại:</label>
                            <input asp-for="SoDienThoai"
                                   class="form-control"
                                   pattern="^\d{10,11}$"
                                   minlength="10"
                                   maxlength="11"
                                   placeholder="Nhập số điện thoại (tùy chọn)"
                                   title="Số điện thoại phải từ 10 đến 11 chữ số (hoặc để trống)." />
                            <span asp-validation-for="SoDienThoai" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Facebook:</label>
                            <input asp-for="Facebook" class="form-control" />

                        </div>

                    </div>

                    <!-- Hàng 2: Địa chỉ, mô tả và ảnh -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Địa chỉ:</label>
                            <input asp-for="DiaChi" class="form-control" />
                            <span asp-validation-for="DiaChi" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Mô tả:</label>
                            <textarea asp-for="MoTa" class="form-control" rows="3" maxlength="50"></textarea>
                            <span asp-validation-for="MoTa" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Instagram:</label>
                            <input asp-for="Instagram" class="form-control" />

                        </div>
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">Thêm ảnh cá nhân:</label>
                            <input type="file" name="AnhCaNhanFile" id="AnhCaNhanFile" class="form-control" />
                        </div>
                    </div>
                </div>

                <!-- Phần ảnh cá nhân -->
                <h4 class="text-center mt-4">Ảnh Cá nhân</h4>
                @if (Model.AnhCaNhan != null && Model.AnhCaNhan.Any())
                {
                    <div class="photo-grid">
                        @if (Model.AnhCaNhan != null && Model.AnhCaNhan.Any())
                        {
                            @foreach (var anh in Model.AnhCaNhan)
                            {
                                <div class="photo-item" id="image-@anh.IDAnhCN">
                                    <div class="image-frame position-relative">
                                        <img src="@Url.Content("~/uploads/" + anh.HinhAnh)" alt="Ảnh cá nhân" />
                                        <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0"
                                                onclick="deleteImage(@anh.IDAnhCN)">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p class="text-center">Chưa có ảnh cá nhân.</p>
                        }
                    </div>

                }
                else
                {
                    <p class="text-center">Chưa có ảnh cá nhân.</p>
                }

                <!-- Nút lưu và quay lại -->
                <div class="text-center mt-4">
                    <input type="submit" value="Lưu" class="btn btn-primary" />
                    <a asp-action="Index" class="btn btn-secondary">Quay lại</a>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    // Kiểm tra và hiển thị thông báo nếu có lỗi
    @if (ViewBag.ErrorMessage != null)
    {
        <text>
                Swal.fire({
                    icon: 'error',
                title: 'Lỗi',
                text: '@Html.Raw(ViewBag.ErrorMessage)',
                position: 'top-end',
                toast: true,
                showConfirmButton: false,
                timer: 3000,
                customClass: {
                    container: 'custom-swal-container',
                popup: 'custom-swal-popup'
                            }
                        });
        </text>
    }


        // Hiển thị nút xóa khi hover vào ảnh
        document.querySelectorAll('.image-frame').forEach(item => {
            item.addEventListener('mouseenter', () => {
                item.querySelector('.btn-danger').style.display = 'block';
            });
            item.addEventListener('mouseleave', () => {
                item.querySelector('.btn-danger').style.display = 'none';
            });
        });

    function deleteImage(id) {
        Swal.fire({
            title: "Bạn có chắc chắn muốn xóa ảnh này?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Xóa",
            cancelButtonText: "Hủy"
        }).then((result) => {
            if (result.isConfirmed) {
                $.post(`/CapNhatThongTin/DeleteImage/${id}`, function () {
                    // Xóa phần tử ảnh khỏi giao diện
                    $(`#image-${id}`).remove();
                    Swal.fire("Đã xóa", "Ảnh đã được xóa thành công", "success");
                }).fail(function () {
                    Swal.fire("Lỗi", "Không thể xóa ảnh", "error");
                });
            }
        });
    }


    // Function to reload images dynamically
    function loadImages() {
        $.get('@Url.Action("LoadImages", "CapNhatThongTin", new { id = Model.IDProfile })', function (data) {
            $('.photo-grid').html(data);
        });
    }
    // Lấy ngày hiện tại
    const today = new Date().toISOString().split('T')[0];
    // Gán giá trị max cho input Ngày sinh
    document.getElementById('ngaySinh').setAttribute('max', today);
</script>