@model IEnumerable<AHTB_TimBanCungGu_API.ViewModels.RoleVM>
@{
    ViewData["Title"] = "Quản Lý Quyền";
    Layout = "~/Areas/Admin/Views/SharedAdmin/_LayoutAdmin.cshtml";
}
<!-- SweetAlert2 CDN -->
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.6/dist/sweetalert2.min.css" rel="stylesheet">
<link href="~/css/indexQuyen.css" rel="stylesheet" />
<!-- Toast Notification -->
@* <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
    <div id="deleteSuccessToast" class="toast align-items-center text-bg-dark border-0 shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body d-flex align-items-center">
                <i class="fas fa-check-circle me-2 text-success" style="font-size: 1.5rem;"></i>
                <span>Xóa thành công!</span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div> *@
<div class="table-container">
    <p class="text-end mb-3">
        <button class="btn btn-success" id="createRoleBtn">
            <i class="fas fa-plus"></i> Thêm Mới
        </button>
    </p>
    <table class="table text-light">
        <thead>
            <tr>
                <th><i class="fas fa-user-cog"></i> Vai Trò</th>
                <th><i class="fas fa-user"></i> User Đang Quản Lý</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.TenRole</td>
                    <td>
                        <span class="user-info @(item.User == "Chưa có nhân viên nào nhận quyền" ? "no-user" : "has-user")">
                            @item.User
                        </span>
                    </td>
                    <td>
                        <div class="d-flex">
                            <button class="btn btn-primary me-2 editRoleBtn" data-id="@item.IDRole">
                                <i class="fas fa-edit"></i>
                            </button>
                            <form asp-action="Delete" asp-route-id="@item.IDRole" method="post" class="delete-form">
                                <button type="submit" id="" class="btn btn-danger">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="roleModal" tabindex="-1" role="dialog" aria-labelledby="roleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" id="roleModalContent">
            <!-- Nội dung sẽ được tải vào đây -->
        </div>
    </div>
</div>

<!-- Thêm thư viện jQuery và Bootstrap -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.6/dist/sweetalert2.all.min.js"></script>

<script>

    $(document).ready(function () {
        // Tải form thêm mới vào modal
        $('#createRoleBtn').click(function () {
            $('#roleModal').modal('show');
            $('#roleModalContent').load('/Admin/Quyenss/Create');
        });

        // Phân công sự kiện cho các nút chỉnh sửa được tạo động
        $(document).on('click', '.editRoleBtn', function () {
            const id = $(this).data('id');
            $('#roleModal').modal('show');
            $('#roleModalContent').load(`/Admin/Quyenss/Edit/${id}`);
        });

        $(document).ready(function () {
            // Xử lý sự kiện submit chỉ cho form xóa
            $(document).on('submit', 'form.delete-form', function (event) {
                event.preventDefault(); // Ngừng hành động submit mặc định

                const form = $(this); // Lấy form xóa cần xử lý

                Swal.fire({
                    title: 'Bạn có chắc chắn muốn xóa không?',
                    text: "Hành động này không thể hoàn tác!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Xóa',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Thực hiện submit nếu người dùng xác nhận
                        $.post(form.attr('action'), form.serialize(), function () {
                            // Hiển thị thông báo thành công
                            const toast = new bootstrap.Toast($('#deleteSuccessToast'));
                            toast.show();

                            // Tải lại trang sau khi hiển thị thông báo
                            setTimeout(function () {
                                location.reload();
                            }, 1000); // Chờ 1 giây trước khi tải lại trang
                        }).fail(function () {
                            Swal.fire(
                                'Thất bại!',
                                'Không thể xóa. Vui lòng thử lại.',
                                'error'
                            );
                        });
                    }
                });
            });
        });

    });
</script>
